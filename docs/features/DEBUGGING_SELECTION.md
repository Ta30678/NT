# 調試選取問題

## 如何調試

### 1. 打開瀏覽器開發者工具

按 **F12** 打開控制台

### 2. 執行選取操作

拖曳框選梁，控制台會顯示詳細信息：

```
=== 選擇結果 ===
選擇框: (622, 428) → (979, 806)
模式: Crossing (碰到即選)
✓ 選中 15 個: b10[(622,500)→(693,500)], b6[(622,650)→(693,650)], ...
✗ 未選中（前10個）: b11-1[(200,230)→(450,230)], ...
```

### 3. 檢查座標

看看選中的梁的座標是否真的在框內或碰到框。

### 4. 截圖給我

如果還有問題，截圖發給我：
- 選擇框的範圍（綠色虛線框）
- 控制台輸出
- 哪些梁選錯了

## 常見問題

### 問題 1：選中了框外的梁

**可能原因**：
- 線段相交算法有誤
- 座標系統不一致

**解決方案**：
查看控制台輸出，檢查選中梁的座標是否真的在框內。

### 問題 2：框內的梁沒選中

**可能原因**：
- Window 模式判定太嚴格
- 浮點數精度問題

**解決方案**：
增加容差值。

### 問題 3：縮放後選取不準

**可能原因**：
- 座標轉換問題
- SVG 變換沒有正確應用

**解決方案**：
檢查 `getSVGCoords` 函數。

## 測試用例

### 測試 1：垂直梁
```
梁: (100, 100) → (100, 200)
框: (50, 50) → (150, 250)
預期: ✓ 選中（Window 和 Crossing 都選中）
```

### 測試 2：水平梁
```
梁: (100, 100) → (200, 100)
框: (50, 50) → (150, 150)
預期: ✗ 未選中（Window）Window 模式：梁的右端在框外
預期: ✓ 選中（Crossing）Crossing 模式：梁碰到框
```

### 測試 3：斜梁
```
梁: (100, 100) → (200, 200)
框: (50, 150) → (250, 250)
預期: ✗ 未選中（Window）Window 模式：梁的起點在框外
預期: ✓ 選中（Crossing）Crossing 模式：梁穿過框
```

## 可能需要的改進

### 1. 增加容差值

```javascript
const TOLERANCE = 0.5; // 容差值

isInside = (x1 >= minX - TOLERANCE && x1 <= maxX + TOLERANCE && ...);
```

### 2. 改進線段相交算法

確保所有相交情況都被檢測到。

### 3. 添加視覺化調試

在選擇框上繪製座標數字。

## 下一步

請：
1. 執行框選
2. 查看控制台輸出
3. 告訴我：
   - 選擇框的座標
   - 哪些梁選錯了
   - 那些梁的實際座標

我會根據具體情況調整算法！
